<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive K3s Cluster Builder</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Play, CheckCircle, Loader, Coffee, Terminal, Server, Zap } = LucideReact;

        const K3sInteractiveDemo = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [completedSteps, setCompletedSteps] = useState(new Set());
            const [isRunning, setIsRunning] = useState(false);
            const [deploymentStats, setDeploymentStats] = useState({
                vmsCreated: 0,
                commandsRun: 0,
                timeElapsed: 0
            });

            const steps = [
                {
                    id: 'env-setup',
                    title: 'â˜• Setting up the environment',
                    description: 'Installing Go, Pulumi, and generating SSH keys',
                    command: 'brew install go pulumi && ssh-keygen -t rsa',
                    output: 'Installing packages...\ngo version go1.21.0 darwin/arm64\npulumi version v3.180.0\nGenerating SSH keys...\nâœ… Environment ready for deployment!',
                    duration: 2500,
                    insight: 'This is where most tutorials skip the boring setup. Don\'t skip it!'
                },
                {
                    id: 'proxmox-auth',
                    title: 'ðŸ” Connecting to Proxmox',
                    description: 'Setting up API authentication with Proxmox VE',
                    command: 'export PROXMOX_API_TOKEN="..." && pulumi config set endpoint',
                    output: 'Connecting to Proxmox at 192.168.90.102:8006...\nValidating API token...\nTesting SSH connection...\nâœ… Authentication successful!',
                    duration: 2000,
                    insight: 'API tokens are way better than passwords. Trust me on this one.'
                },
                {
                    id: 'vm-templates',
                    title: 'ðŸ“¦ Creating VM templates',
                    description: 'Setting up Ubuntu cloud image template for cloning',
                    command: 'qm create 9000 --name ubuntu-template && qm template 9000',
                    output: 'Downloading Ubuntu 22.04 cloud image...\nCreating VM template with ID 9000...\nConfiguring cloud-init settings...\nâœ… Template ready for cloning!',
                    duration: 3500,
                    insight: 'Templates are like Docker images for VMs. Create once, clone many times.'
                },
                {
                    id: 'loadbalancer',
                    title: 'âš–ï¸ Deploying load balancer',
                    description: 'Creating HAProxy VM to distribute K3s API requests',
                    command: 'pulumi up # Creating loadbalancer VM...',
                    output: 'Creating VM: k3s-loadbalancer (192.168.90.190)\nCloning from template 9000...\nWaiting for VM to boot...\nInstalling HAProxy...\nConfiguring backend servers...\nâœ… Load balancer ready and listening on port 6443!',
                    duration: 4000,
                    insight: 'HAProxy will automatically discover our K3s servers. No manual config needed!'
                },
                {
                    id: 'k3s-cluster',
                    title: 'ðŸš€ Building K3s cluster',
                    description: 'Creating 3 K3s server VMs with high availability',
                    command: 'pulumi up # Creating K3s servers...',
                    output: 'Creating VM: k3s-server-1 (192.168.90.187)\nCreating VM: k3s-server-2 (192.168.90.188)\nCreating VM: k3s-server-3 (192.168.90.189)\nAll VMs created successfully!\n\nInstalling K3s on first server with --cluster-init...\nGenerating cluster token...\nJoining additional servers to cluster...\nâœ… 3-node HA cluster formed!',
                    duration: 6000,
                    insight: 'The first server initializes the cluster, others join automatically. Like a fancy kubernetes dance!'
                },
                {
                    id: 'verification',
                    title: 'âœ… Testing the cluster',
                    description: 'Extracting kubeconfig and verifying everything works',
                    command: 'kubectl get nodes --kubeconfig=./kubeconfig',
                    output: 'Extracting kubeconfig from k3s-server-1...\nUpdating server URL to use load balancer...\nSaving kubeconfig to ./kubeconfig\n\nTesting cluster connectivity...\n\nNAME           STATUS   ROLES                  AGE\nk3s-server-1   Ready    control-plane,master   2m\nk3s-server-2   Ready    control-plane,master   1m\nk3s-server-3   Ready    control-plane,master   1m\n\nðŸŽ‰ High-availability K3s cluster is ready!\nðŸ’° Total cost: $0 (running on your hardware)\nâš¡ Time to deploy: ~12 minutes',
                    duration: 3000,
                    insight: 'And just like that, you have a production-ready Kubernetes cluster!'
                }
            ];

            const runStep = async (stepIndex) => {
                setIsRunning(true);
                setCurrentStep(stepIndex);
                
                const interval = setInterval(() => {
                    setDeploymentStats(prev => ({
                        vmsCreated: stepIndex >= 3 ? Math.min(4, prev.vmsCreated + 1) : prev.vmsCreated,
                        commandsRun: prev.commandsRun + 1,
                        timeElapsed: prev.timeElapsed + 1
                    }));
                }, 200);
                
                await new Promise(resolve => setTimeout(resolve, steps[stepIndex].duration));
                
                clearInterval(interval);
                setCompletedSteps(prev => new Set([...prev, stepIndex]));
                setIsRunning(false);
            };

            const runAll = async () => {
                for (let i = 0; i < steps.length; i++) {
                    await runStep(i);
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
            };

            const reset = () => {
                setCurrentStep(0);
                setCompletedSteps(new Set());
                setIsRunning(false);
                setDeploymentStats({ vmsCreated: 0, commandsRun: 0, timeElapsed: 0 });
            };

            return React.createElement('div', {
                className: "max-w-4xl mx-auto bg-white rounded-lg shadow-xl border border-gray-200 m-4"
            }, [
                // Header
                React.createElement('div', {
                    key: 'header',
                    className: "bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-t-lg"
                }, [
                    React.createElement('div', {
                        key: 'header-content',
                        className: "text-center"
                    }, [
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-2xl font-bold text-white mb-2 flex items-center justify-center gap-2"
                        }, [
                            React.createElement(Coffee, { key: 'coffee-icon', className: "text-yellow-300" }),
                            'Interactive K3s Deployment Demo'
                        ]),
                        React.createElement('p', {
                            key: 'subtitle',
                            className: "text-blue-100"
                        }, 'Experience the full deployment process â€” click through each step!')
                    ])
                ]),

                // Controls
                React.createElement('div', {
                    key: 'controls',
                    className: "p-4 bg-gray-50 border-b flex items-center justify-between flex-wrap gap-4"
                }, [
                    React.createElement('div', {
                        key: 'control-buttons',
                        className: "flex gap-3"
                    }, [
                        React.createElement('button', {
                            key: 'run-all',
                            onClick: runAll,
                            disabled: isRunning,
                            className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium"
                        }, [
                            React.createElement(Play, { key: 'play-icon', size: 16 }),
                            isRunning ? 'Running...' : 'Run Full Demo'
                        ]),
                        React.createElement('button', {
                            key: 'reset',
                            onClick: reset,
                            disabled: isRunning,
                            className: "px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50"
                        }, 'Reset')
                    ]),
                    
                    // Live Stats
                    React.createElement('div', {
                        key: 'stats',
                        className: "flex gap-4 text-sm"
                    }, [
                        React.createElement('div', {
                            key: 'vms-stat',
                            className: "flex items-center gap-1"
                        }, [
                            React.createElement(Server, { key: 'server-icon', size: 16, className: "text-blue-600" }),
                            React.createElement('span', { key: 'vms-count' }, `${deploymentStats.vmsCreated} VMs`)
                        ]),
                        React.createElement('div', {
                            key: 'commands-stat',
                            className: "flex items-center gap-1"
                        }, [
                            React.createElement(Terminal, { key: 'terminal-icon', size: 16, className: "text-green-600" }),
                            React.createElement('span', { key: 'commands-count' }, `${deploymentStats.commandsRun} Commands`)
                        ]),
                        React.createElement('div', {
                            key: 'time-stat',
                            className: "flex items-center gap-1"
                        }, [
                            React.createElement(Zap, { key: 'zap-icon', size: 16, className: "text-orange-600" }),
                            React.createElement('span', { key: 'time-count' }, `${deploymentStats.timeElapsed}s`)
                        ])
                    ])
                ]),

                // Main Content
                React.createElement('div', {
                    key: 'main-content',
                    className: "grid md:grid-cols-2 gap-0"
                }, [
                    // Steps List
                    React.createElement('div', {
                        key: 'steps-list',
                        className: "p-6 bg-white"
                    }, [
                        React.createElement('h3', {
                            key: 'steps-title',
                            className: "font-semibold text-lg mb-4 text-gray-800"
                        }, 'Deployment Steps'),
                        React.createElement('div', {
                            key: 'steps-container',
                            className: "space-y-3"
                        }, steps.map((step, index) => 
                            React.createElement('div', {
                                key: step.id,
                                className: `p-4 rounded-lg border-2 transition-all duration-300 cursor-pointer ${
                                    completedSteps.has(index) 
                                        ? 'border-green-300 bg-green-50' 
                                        : currentStep === index && isRunning
                                        ? 'border-blue-300 bg-blue-50 animate-pulse'
                                        : 'border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50'
                                }`,
                                onClick: () => !isRunning && runStep(index)
                            }, [
                                React.createElement('div', {
                                    key: 'step-content',
                                    className: "flex items-start gap-3"
                                }, [
                                    React.createElement('div', {
                                        key: 'step-icon',
                                        className: "flex-shrink-0 mt-1"
                                    }, 
                                        completedSteps.has(index) ? 
                                            React.createElement(CheckCircle, { className: "text-green-600", size: 20 }) :
                                            currentStep === index && isRunning ?
                                                React.createElement(Loader, { className: "text-blue-600 animate-spin", size: 20 }) :
                                                React.createElement('div', {
                                                    className: "w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center"
                                                }, React.createElement('span', {
                                                    className: "text-xs font-medium text-gray-500"
                                                }, index + 1))
                                    ),
                                    React.createElement('div', {
                                        key: 'step-details',
                                        className: "flex-1"
                                    }, [
                                        React.createElement('h4', {
                                            key: 'step-title',
                                            className: "font-medium text-gray-800 text-sm"
                                        }, step.title),
                                        React.createElement('p', {
                                            key: 'step-desc',
                                            className: "text-xs text-gray-600 mt-1"
                                        }, step.description),
                                        completedSteps.has(index) && React.createElement('div', {
                                            key: 'step-insight',
                                            className: "mt-2 p-2 bg-blue-50 rounded text-xs text-blue-700 border-l-3 border-blue-300"
                                        }, `ðŸ’¡ ${step.insight}`)
                                    ])
                                ])
                            ])
                        ))
                    ]),

                    // Terminal Output
                    React.createElement('div', {
                        key: 'terminal',
                        className: "bg-gray-900 p-6"
                    }, [
                        React.createElement('div', {
                            key: 'terminal-header',
                            className: "flex items-center gap-2 mb-4"
                        }, [
                            React.createElement('div', {
                                key: 'terminal-buttons',
                                className: "flex gap-1"
                            }, [
                                React.createElement('div', { key: 'red-btn', className: "w-3 h-3 rounded-full bg-red-500" }),
                                React.createElement('div', { key: 'yellow-btn', className: "w-3 h-3 rounded-full bg-yellow-500" }),
                                React.createElement('div', { key: 'green-btn', className: "w-3 h-3 rounded-full bg-green-500" })
                            ]),
                            React.createElement('span', {
                                key: 'terminal-title',
                                className: "text-gray-400 text-sm font-mono"
                            }, 'terminal')
                        ]),
                        
                        React.createElement('div', {
                            key: 'terminal-content',
                            className: "h-80 overflow-y-auto font-mono text-sm"
                        }, 
                            currentStep < steps.length && React.createElement('div', {
                                key: 'terminal-output',
                                className: "space-y-2"
                            }, [
                                React.createElement('div', {
                                    key: 'command',
                                    className: "text-blue-400"
                                }, `$ ${steps[currentStep].command}`),
                                
                                (completedSteps.has(currentStep) || isRunning) && React.createElement('div', {
                                    key: 'output',
                                    className: "text-green-400 whitespace-pre-line"
                                }, steps[currentStep].output),

                                !completedSteps.has(currentStep) && !isRunning && React.createElement('div', {
                                    key: 'prompt',
                                    className: "text-gray-500 italic"
                                }, 'ðŸ‘† Click the step above to run this command')
                            ])
                        )
                    ])
                ]),

                // Progress Bar
                React.createElement('div', {
                    key: 'progress',
                    className: "p-6 bg-gray-50 border-t"
                }, [
                    React.createElement('div', {
                        key: 'progress-header',
                        className: "flex items-center justify-between mb-3"
                    }, [
                        React.createElement('span', {
                            key: 'progress-label',
                            className: "text-sm font-medium text-gray-700"
                        }, 'Overall Progress'),
                        React.createElement('span', {
                            key: 'progress-count',
                            className: "text-sm text-gray-500"
                        }, `${completedSteps.size} of ${steps.length} steps completed`)
                    ]),
                    React.createElement('div', {
                        key: 'progress-bar-bg',
                        className: "w-full bg-gray-200 rounded-full h-3"
                    }, 
                        React.createElement('div', {
                            key: 'progress-bar',
                            className: "bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500 ease-out",
                            style: { width: `${(completedSteps.size / steps.length) * 100}%` }
                        })
                    ),
                    
                    completedSteps.size === steps.length && React.createElement('div', {
                        key: 'success-message',
                        className: "mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"
                    }, [
                        React.createElement('div', {
                            key: 'success-header',
                            className: "flex items-center gap-2 text-green-800 mb-2"
                        }, [
                            React.createElement(CheckCircle, { key: 'success-icon', size: 20 }),
                            React.createElement('span', {
                                key: 'success-title',
                                className: "font-semibold"
                            }, 'ðŸŽ‰ Congratulations!')
                        ]),
                        React.createElement('p', {
                            key: 'success-text',
                            className: "text-green-700 text-sm mb-3"
                        }, 'You\'ve successfully deployed a production-ready, high-availability K3s cluster! Your infrastructure is now ready for real workloads.'),
                        React.createElement('div', {
                            key: 'success-buttons',
                            className: "flex flex-wrap gap-2"
                        }, [
                            React.createElement('button', {
                                key: 'deploy-apps',
                                onClick: () => window.open('https://k3s.io/docs/examples/', '_blank'),
                                className: "px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700"
                            }, 'Deploy Apps'),
                            React.createElement('button', {
                                key: 'run-again',
                                onClick: reset,
                                className: "px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700"
                            }, 'Run Again')
                        ])
                    ])
                ]),

                // Footer CTA
                React.createElement('div', {
                    key: 'footer',
                    className: "p-6 bg-gradient-to-r from-gray-50 to-blue-50 rounded-b-lg border-t"
                }, 
                    React.createElement('div', {
                        key: 'footer-content',
                        className: "text-center"
                    }, [
                        React.createElement('h3', {
                            key: 'footer-title',
                            className: "font-semibold text-gray-800 mb-2"
                        }, 'Ready to build your own?'),
                        React.createElement('p', {
                            key: 'footer-text',
                            className: "text-sm text-gray-600 mb-4"
                        }, 'Get the complete code, configuration files, and step-by-step guide'),
                        React.createElement('div', {
                            key: 'footer-buttons',
                            className: "flex flex-wrap justify-center gap-3"
                        }, [
                            React.createElement('button', {
                                key: 'tutorial-btn',
                                onClick: () => window.open('#', '_blank'),
                                className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium"
                            }, 'ðŸ“š Full Tutorial'),
                            React.createElement('button', {
                                key: 'source-btn',
                                onClick: () => window.open('#', '_blank'),
                                className: "px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 text-sm font-medium"
                            }, 'ðŸ’» Source Code')
                        ])
                    ])
                )
            ]);
        };

        // Render the component
        ReactDOM.render(React.createElement(K3sInteractiveDemo), document.getElementById('root'));
    </script>
</body>
</html>
